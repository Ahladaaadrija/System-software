#include <stdio.h>
#include <string.h>
#include <stdlib.h>

char input[100], label[10], ch2;
int addr, w = 0, start, ptaddr, l, length = 0, end, taddr, address;
FILE *fp1, *fp2;


int main() {
    fp1 = fopen("inputt.txt", "r");
    if (fp1 == NULL) {
        printf("Error: Cannot open input.txt\n");
        return 1;
    }

    fp2 = fopen("output.txt", "w");
    if (fp2 == NULL) {
        printf("Error: Cannot open output.txt\n");
        fclose(fp1);
        return 1;
    }

    fscanf(fp1, "%s", input);
    printf("\n\nABSOLUTE LOADER\n");
    fprintf(fp2, "\n----------------------------------------\n");
    fprintf(fp2, "MEMORY ADDRESS\t\tCONTENTS");
    fprintf(fp2, "\n----------------------------------------\n");

    while (strcmp(input, "E") != 0) {
        if (strcmp(input, "H") == 0) {
            fscanf(fp1, "%s %x %x %s", label, &start, &end, input);
            address = start;
        }
        else if (strcmp(input, "T") == 0) {
            l = length;
            ptaddr = addr;
            fscanf(fp1, "%x %x %s", &taddr, &length, input);
            addr = taddr;

            if (w == 0) {
                ptaddr = address;
                w = 1;
            }


            int k;
            for (k = 0; k < (taddr - (ptaddr + l)); k++) {
                fprintf(fp2, "%04X\t\t\t\txx\n", address);
                address++;
            }
           
         
            address = taddr;

       
            int j;
            for(j = 0; j < strlen(input); j += 2) {
                fprintf(fp2, "%04X\t\t\t\t%c%c\n", address, input[j], input[j+1]);
                address++;
            }

            fscanf(fp1, "%s", input);
        }
        else {
            int j;
            for(j = 0; j < strlen(input); j += 2) {
                fprintf(fp2, "%04X\t\t\t\t%c%c\n", address, input[j], input[j+1]);
                address++;
            }
            fscanf(fp1, "%s", input);
        }
    }

    fprintf(fp2, "----------------------------------------\n");
    fclose(fp1);
    fclose(fp2);

 
    printf("\n\nThe contents of the output file:\n");
    fp2 = fopen("output.txt", "r");
    if (fp2 == NULL) {
        printf("Error: Cannot open output.txt for reading\n");
        return 1;
    }

    ch2 = fgetc(fp2);
    while (ch2 != EOF) {
        printf("%c", ch2);
        ch2 = fgetc(fp2);
    }
    fclose(fp2);

    return 0;
}

